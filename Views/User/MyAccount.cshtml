@model KwasantWeb.ViewModels.ManageUserViewModel

@{
    ViewBag.Title = "My Account";
}

<h2>@ViewBag.Title.</h2>

<p class="text-success">@ViewBag.StatusMessage</p>
<div class="row">
    <div class="col-md-12">
        @foreach (var remoteCalendar in Model.RemoteCalendars)
        {
            if (!remoteCalendar.AccessGranted)
            {
                @Html.ActionLink(
                    string.Format("Grant Access to {0} Calendar", remoteCalendar.Provider), 
                    "GrantRemoteCalendarAccess", 
                    new { providerName = remoteCalendar.Provider }, 
                    new { @class = "btn btn-default" })
            }
            else
            {
                @Html.ActionLink(
                    string.Format("Revoke Access to {0} Calendar", remoteCalendar.Provider),
                    "RevokeRemoteCalendarAccess",
                    new {providerName = remoteCalendar.Provider},
                    new {@class = "btn btn-default"})
            }
            <br/>
        }
    </div>
</div>
<br/>
@if (Model.RemoteCalendars.Any(c => c.AccessGranted))
{
<div class="row">
    <div class="col-md-12">
        <a href="#" class="btn btn-default" id="syncNowBtn">Synchronize Now!</a>
        <div id="success" style="display: none">Calendars synchronized successfully.</div>
        <div id="sendError" style="display: none"></div>
    </div>
</div>
}

@section scripts
{
    @if (Model.RemoteCalendars.Any(c => c.AccessGranted))
    {
        <script type="text/javascript">
            $(document).ready(function() {
                var syncing = false;
                $('#syncNowBtn').click(function() {
                    if (syncing)
                        return false;
                    syncing = true;
                    $('#syncNowBtn').addClass('disabled');
                    $.post('@Url.Action("SyncCalendarsNow", "User")',
                        function(result) {
                            if (result.success) {
                                $('#sendError').text('').hide();
                                $('#success').show();
                            } else {
                                $('#sendError').text(result.error).show();
                            }
                            syncing = false;
                            $('#syncNowBtn').removeClass('disabled');
                        },
                        'json');
                    return false;
                });
            });
        </script>
    }
}

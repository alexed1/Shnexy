@using Data.Entities.Enumerations
@using Newtonsoft.Json
@model KwasantWeb.ViewModels.ClarificationRequestViewModel
@{ Layout = "~/Views/Shared/_Blank.cshtml"; }
@section immediateScripts
{
    @Scripts.Render("~/bundles/js/jquery")
    @Scripts.Render("~/bundles/js/jqueryvalidate")

    <script src="/Content/js/Kwasant/Popup.js"></script>
}
@section scripts
{
    @Scripts.Render("~/bundles/js/modernizr")
    @Scripts.Render("~/bundles/js/bootstrap")
    @Scripts.Render("~/bundles/js/common")
}
@section styles
{
    @Styles.Render("~/bundles/css/bootstrap30")
    @Styles.Render("~/bundles/css/backendcss")
}

<div id="requestSentText" style="display: none;">
    <h3>Request Sent</h3>
    <div class="space">
        <div style="clear: both">
            <div style="float: left">
                <a href="javascript:close(true);">
                    <div style="width: 100px;">Close</div>
                </a>
            </div>
        </div>
    </div>
</div>
<form id="f">
    <h3>
        @Html.Raw(Model.Id == 0 ? "New Clarification Request" : "Editing Clarification Request")
    </h3>
    @if (Model.QuestionsCount > 0)
    {
    <h4>
        @Html.Raw(string.Format("There {0} {1} question{2} already in this request.", 
        Model.QuestionsCount > 1 ? "are" : "is", 
        Model.QuestionsCount, 
        Model.QuestionsCount % 10 == 1 ? "" : "s"))
    </h4>
    }
    <hr />
    <div id="sendError"></div>
    <div class="formItem">
        <div class="formLabel">
            To:
       
        </div>
        <input type="text" value="@Model.Recipients" disabled="disabled" />
    </div>
    <div class="formItem">
        <div class="formLabel">
            Enter Message
       
        </div>
        
        @Html.TextAreaFor(m => m.Question, 5, 20, new { @class = "form-control col-md-1" })
    </div>
    @Html.HiddenFor(m => m.Id, new { @class = "form-control col-md-1" })
    @Html.HiddenFor(m => m.BookingRequestId, new { @class = "form-control col-md-1" })
    <hr />
    <div class="space">
        <div style="clear: both">
            <div style="float: left">
                <input id="btnSend" type="button" value="Send" style="border: 2px solid black; height: 30px; margin-right: 20px; width: 100px;" />
            </div>
            <div style="float: left">
                <a href="javascript:closeWithUnsavedDataCheck(modifiedState);">
                    <div style="width: 100px;">Cancel</div>
                </a>
            </div>
        </div>
        <br />
        <br />
    </div>
</form>

<script type="text/javascript">
    var modifiedState = { modified: false };
    $(document).ready(function() {
        $(".form-control").change(function() {
            modifiedState.modified = true;
        });

        $('#btnSend').click(function() {
            $.post('@Url.Action("Send", "ClarificationRequest")',
                $('#f').serialize(),
                function (result) {
                    if (result.success) {
                        $('#sendError').text('');
                        $('#f').hide();
                        $('#requestSentText').show();
                    } else {
                        $('#sendError').text(result.error);
                    }
                },
                'json');
            return false;
        });
    });

    $(function () {
        $('#question').focus();
        $('#f').validate();
    });

</script>